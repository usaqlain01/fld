#!/usr/bin/env php
<?php

// if you don't want to setup permissions the proper way, just uncomment the following PHP line
// read http://symfony.com/doc/current/book/installation.html#configuration-and-setup for more information
//umask(0000);

set_time_limit(0);

foreach (array(__DIR__.'/../vendor/autoload.php', __DIR__.'/../../../autoload.php') as $file) {
    if (file_exists($file)) {
        define('ASSETIC_APP_COMPOSER_INSTALL', $file);
        break;
    }
}

if (!defined('ASSETIC_APP_COMPOSER_INSTALL')) {
    die(
        'You must set up the project dependencies, run the following commands:'.PHP_EOL.
        'curl -s http://getcomposer.org/installer | php'.PHP_EOL.
        'php composer.phar install'.PHP_EOL
    );
}

require ASSETIC_APP_COMPOSER_INSTALL;

use Symfony\Component\Console\Input\ArgvInput;
use Cilex\Provider\Console\ConsoleServiceProvider;
use Symfony\Component\Debug\Debug;

$input = new ArgvInput();
$debug = getenv('SYMFONY_DEBUG') !== '0' && !$input->hasParameterOption(array('--no-debug', ''));

if ($debug) {
    Debug::enable();
}

$app = new Pimple\Container;
$app['console.name'] = 'Assetic';
$app['console.version'] = '1.0-dev';
$app['console.class'] = 'Application';
$app['config.path'] = __DIR__ .'/../assetic.yml';

(new ConsoleServiceProvider)->register($app);
(new ConfigServiceProvider)->register($app);
(new AsseticServiceProvider)->register($app);

$app['console']->run($input);
