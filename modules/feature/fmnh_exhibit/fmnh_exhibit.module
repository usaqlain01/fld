<?php
/**
 * @file
 * Code for the Field Museum exhibit feature.
 */

include_once 'fmnh_exhibit.features.inc';

function fmnh_exhibit_admin_paths() {
  return array(
    'at-the-field/admin' => TRUE,
    'at-the-field/*/admin' => TRUE,
  );
}

/**
 * @param $variables
 * @param $hook
 */
function fmnh_exhibit_preprocess_node(&$variables, $hook) {

  // Populate the old-fashioned content[links] value with the concatenated
  // rendering of field_exhibit_type.
  if ($variables['view_mode'] == 'promo') {
    $node = $variables['node'];
    $links = array();

    foreach (array('field_exhibit_type') as $field_name) {
      if ($items = field_get_items('node', $node, $field_name)) {
        foreach ($items as $item) {
          $entity = $item['entity'];
          list($id,,) = entity_extract_ids('taxonomy_term', $entity);
          $links['promo__category list--inline__item taxonomy_term-'. $id] = array(
            'title' => $entity->name,
            'href' => 'at-the-field/exhibitions/'. $entity->tid,
          );
        }
      }
    }

    $variables['content']['links'] = array(
      '#theme' => 'links__promo__category',
      '#links' => $links,
      '#attributes' => array('class' => array('promo__categories', 'list--inline')),
    );
  }

  // Stash ticketed status in template variable.
  $items = field_get_items('node', $variables['node'], 'field_ticketed');
  if ($items) {
    $item = reset($items);
    $variables['ticketed'] = ($item['value'] == 1);
  }
}
